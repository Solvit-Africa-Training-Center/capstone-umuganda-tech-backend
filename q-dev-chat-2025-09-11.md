<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 200px 0 20px 0;">

<div style="font-size: 24px; margin-bottom: 12px;"><strong>Amazon Q</strong></div>
<div style="background: rgba(128, 128, 128, 0.15); border: 1px solid rgba(128, 128, 128, 0.25); border-radius: 8px; padding: 8px; margin: 4px 0; text-align: center;">
<div style="font-size: 14px; margin-bottom: 4px;"><strong>Did you know?</strong></div>
<div>You can now see logs with 1-Click!</div>
</div>

Select code & ask me to explain, debug or optimize it, or type `/` for quick actions

</div>

---

$ docker-compose exec web python manage.py makemigrations
time=&quot;2025-09-11T10:03:47+02:00&quot; level=warning msg=&quot;C:\\Users\\mkthi\\OneDrive\\Desktop\\ProjectsSt\\Umuganda_root\\capstone-umuganda-tech-backend\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion&quot;
service &quot;web&quot; is not running

---

The error shows two issues:

1. **Obsolete version attribute**: The `version: '3.8'` line is deprecated in newer Docker Compose versions
2. **Service not running**: The "web" service isn't currently running

Let me check your current docker-compose.yml and help fix these issues.

---


To fix these issues:

**1. Remove the obsolete version line** from docker-compose.yml (line 1)

**2. Start the services** before running migrations:

```bash
# First, start the services
docker-compose up -d

# Wait for services to be healthy, then run migrations
docker-compose exec web python manage.py makemigrations
```

The warning about the `version` attribute is because Docker Compose no longer requires version specification in newer versions. Your compose file will work fine without it.

If you want to remove the warning, simply delete the first line `version: '3.8'` from your docker-compose.yml file.

---

$ docker-compose exec web python manage.py makemigrations
service &quot;web&quot; is not running
(venv)

---


The "web" service isn't running. You need to start the Docker services first:

```bash
# Start the services
docker-compose up -d

# Then run migrations
docker-compose exec web python manage.py makemigrations
```

If the services fail to start, check the logs:

```bash
docker-compose logs web
```

The most common issues are:
- Missing Dockerfile in the project root
- Build errors in the Django application
- Database connection issues

Run `docker-compose up -d` first to get the services running.

---

$ docker-compose up -d
[+] Running 2/2
 ✔ Container capstone-umuganda-tech-backend-db-1   Healthy                                            0.7s 
 ✔ Container capstone-umuganda-tech-backend-web-1  Started                                            1.4s 
(venv) 
mkthi@Thiedra MINGW64 ~/OneDrive/Desktop/ProjectsSt/Umuganda_root/capstone-umuganda-tech-backend (feature/dockerizing_project)
$ docker-compose exec web python manage.py makemigrations
No changes detected
(venv)

---


Perfect! The services are now running successfully and the makemigrations command worked. The "No changes detected" message means there are no new model changes to create migrations for.

If you need to apply existing migrations to the database, run:

```bash
docker-compose exec web python manage.py migrate
```

Your Docker setup is working correctly now. The services are healthy and Django can connect to the PostgreSQL database.

---

$ docker-compose exec web python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
Running migrations:
  No migrations to apply.
(venv)

---


Excellent! Your Django application is fully set up and running in Docker. The migration output shows:

- All your Django apps are recognized (admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users)
- All migrations are already applied to the database
- No pending migrations

Your Docker setup is working perfectly. The Django application can successfully connect to the PostgreSQL database and all database tables are up to date.

You can now access your application at http://localhost:8000

---

what next

---


Now that your Docker setup is working, here are the typical next steps:

**1. Create a superuser:**
```bash
docker-compose exec web python manage.py createsuperuser
```

**2. Test your application:**
- Visit http://localhost:8000 to see your app
- Visit http://localhost:8000/admin to access Django admin

**3. Development workflow:**
```bash
# View logs
docker-compose logs -f web

# Stop services
docker-compose down

# Restart after code changes
docker-compose restart web
```

**4. Common tasks:**
```bash
# Run tests
docker-compose exec web python manage.py test

# Collect static files
docker-compose exec web python manage.py collectstatic

# Shell access
docker-compose exec web python manage.py shell
```

What specific functionality do you want to work on next?

---

docker-compose logs -f web
web-1  | Waiting for database...
web-1  | Database started
web-1  | Migrations for &#39;community&#39;:
web-1  |   apps/community/migrations/0001_initial.py
web-1  |     + Create model Comment
web-1  |     + Create model Post
web-1  |     + Create model PostUpvote
web-1  |   apps/community/migrations/0002_initial.py
web-1  |     + Add field user to comment
web-1  |     + Add field project to post
web-1  |     + Add field user to post
web-1  |     + Add field post to comment
web-1  |     + Add field post to postupvote
web-1  |     + Add field user to postupvote
web-1  |     ~ Alter unique_together for postupvote (1 constraint(s))
web-1  | Migrations for &#39;notifications&#39;:
web-1  |   apps/notifications/migrations/0001_initial.py
web-1  |     + Create model Notification
web-1  |     + Create model NotificationLog
web-1  |   apps/notifications/migrations/0002_initial.py
web-1  |     + Add field project to notification
web-1  |   apps/notifications/migrations/0003_initial.py
web-1  |     + Add field user to notification
web-1  |     + Add field project to notificationlog
web-1  |     + Add field user to notificationlog
web-1  | Migrations for &#39;projects&#39;:
web-1  |   apps/projects/migrations/0001_initial.py
web-1  |     + Create model Attendance
web-1  |     + Create model Certificate
web-1  |     + Create model Project
web-1  |     + Create model ProjectCategory
web-1  |     + Create model ProjectCheckinCode
web-1  |     + Create model ProjectImpact
web-1  |     + Create model ProjectSkill
web-1  |   apps/projects/migrations/0002_initial.py
web-1  |     + Add field user to attendance
web-1  |     + Add field user to certificate
web-1  |     + Add field admin to project
web-1  |     + Add field project to certificate
web-1  |     + Add field project to attendance
web-1  |     + Add field category to project
web-1  |     + Add field project to projectcheckincode
web-1  |     + Add field project to projectimpact
web-1  |     + Add field project to projectskill
web-1  |     + Add field skill to projectskill
web-1  |     ~ Alter unique_together for certificate (1 constraint(s))
web-1  |     ~ Alter unique_together for projectskill (1 constraint(s))
web-1  | Migrations for &#39;users&#39;:
web-1  |   apps/users/migrations/0001_initial.py
web-1  |     + Create model Badge
web-1  |     + Create model OTP
web-1  |     + Create model Skill
web-1  |     + Create model User
web-1  |     + Create model UserBadge
web-1  |     + Create model UserSkill
web-1  | Operations to perform:
web-1  |   Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
web-1  | Running migrations:
web-1  |   Applying contenttypes.0001_initial... OK
web-1  |   Applying contenttypes.0002_remove_content_type_name... OK
web-1  |   Applying auth.0001_initial... OK
web-1  |   Applying auth.0002_alter_permission_name_max_length... OK
web-1  |   Applying auth.0003_alter_user_email_max_length... OK
web-1  |   Applying auth.0004_alter_user_username_opts... OK
web-1  |   Applying auth.0005_alter_user_last_login_null... OK
web-1  |   Applying auth.0006_require_contenttypes_0002... OK
web-1  |   Applying auth.0007_alter_validators_add_error_messages... OK
web-1  |   Applying auth.0008_alter_user_username_max_length... OK
web-1  |   Applying auth.0009_alter_user_last_name_max_length... OK
web-1  |   Applying auth.0010_alter_group_name_max_length... OK
web-1  |   Applying auth.0011_update_proxy_permissions... OK
web-1  |   Applying auth.0012_alter_user_first_name_max_length... OK
web-1  |   Applying users.0001_initial... OK
web-1  |   Applying admin.0001_initial... OK
web-1  |   Applying admin.0002_logentry_remove_auto_add... OK
web-1  |   Applying admin.0003_logentry_add_action_flag_choices... OK
web-1  |   Applying authtoken.0001_initial... OK
web-1  |   Applying authtoken.0002_auto_20160226_1747... OK
web-1  |   Applying authtoken.0003_tokenproxy... OK
web-1  |   Applying authtoken.0004_alter_tokenproxy_options... OK
web-1  |   Applying projects.0001_initial... OK
web-1  |   Applying community.0001_initial... OK
web-1  |   Applying community.0002_initial... OK
web-1  |   Applying notifications.0001_initial... OK
web-1  |   Applying notifications.0002_initial... OK
web-1  |   Applying notifications.0003_initial... OK
web-1  |   Applying projects.0002_initial... OK
web-1  |   Applying sessions.0001_initial... OK
web-1  | Traceback (most recent call last):
web-1  |   File &quot;/app/manage.py&quot;, line 22, in &lt;module&gt;
web-1  |     main()
web-1  |   File &quot;/app/manage.py&quot;, line 18, in main
web-1  |     execute_from_command_line(sys.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 442, in execute_from_command_line
web-1  |     utility.execute()
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 436, in execute
web-1  |     self.fetch_command(subcommand).run_from_argv(self.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 416, in run_from_argv
web-1  |     self.execute(*args, **cmd_options)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 460, in execute
web-1  |     output = self.handle(*args, **options)
web-1  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 209, in handle
web-1  |     collected = self.collect()
web-1  |                 ^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 135, in collect
web-1  |     handler(path, prefixed_path, storage)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 368, in copy_file
web-1  |     if not self.delete_file(path, prefixed_path, source_storage):
web-1  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 278, in delete_file
web-1  |     if self.storage.exists(prefixed_path):
web-1  |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/files/storage/filesystem.py&quot;, line 206, in exists
web-1  |     return os.path.lexists(self.path(name))
web-1  |                            ^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/storage.py&quot;, line 39, in path
web-1  |     raise ImproperlyConfigured(
web-1  | django.core.exceptions.ImproperlyConfigured: You&#39;re using the staticfiles app without having set the STATIC_ROOT setting to a filesystem path.
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  |
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 08:08:39
web-1  | Django version 5.2.5, using settings &#39;umugandatech.settings&#39;
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
web-1  |
web-1  | WARNING: This is a development server. Do not use it in a production setting. Use a production WSGI or ASGI server instead.
web-1  | For more information on production servers see: https://docs.djangoproject.com/en/5.2/howto/deployment/

---

Good news! Your Django application is running successfully at http://0.0.0.0:8000. The migrations applied correctly and the server started.

There's one configuration issue to fix - the `STATIC_ROOT` setting. Let me check your Django settings:

---


The issue is that `STATIC_ROOT` is missing from your settings. Add this line to your settings.py:

```python
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
```

Add it right after the `STATIC_URL = 'static/'` line. This will fix the staticfiles error.

Your application is running successfully! You can now:

1. Visit http://localhost:8000 to see your Django app
2. Create a superuser to access admin panel
3. Start developing your Umuganda community platform features

The error doesn't prevent the server from running - it's just a configuration warning for static files collection.

---

this what i have:STATIC_URL = &#39;static/&#39;

---


Add this line right after `STATIC_URL = 'static/'`:

```python
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
```

So it should look like:

```python
STATIC_URL = 'static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
```

This will fix the staticfiles configuration error you saw in the logs.

---

$ docker-compose logs -f web
web-1  | Waiting for database...
web-1  | Database started
web-1  | Migrations for &#39;community&#39;:
web-1  |   apps/community/migrations/0001_initial.py
web-1  |     + Create model Comment
web-1  |     + Create model Post
web-1  |     + Create model PostUpvote
web-1  |   apps/community/migrations/0002_initial.py
web-1  |     + Add field user to comment
web-1  |     + Add field project to post
web-1  |     + Add field user to post
web-1  |     + Add field post to comment
web-1  |     + Add field post to postupvote
web-1  |     + Add field user to postupvote
web-1  |     ~ Alter unique_together for postupvote (1 constraint(s))
web-1  | Migrations for &#39;notifications&#39;:
web-1  |   apps/notifications/migrations/0001_initial.py
web-1  |     + Create model Notification
web-1  |     + Create model NotificationLog
web-1  |   apps/notifications/migrations/0002_initial.py
web-1  |     + Add field project to notification
web-1  |   apps/notifications/migrations/0003_initial.py
web-1  |     + Add field user to notification
web-1  |     + Add field project to notificationlog
web-1  |     + Add field user to notificationlog
web-1  | Migrations for &#39;projects&#39;:
web-1  |   apps/projects/migrations/0001_initial.py
web-1  |     + Create model Attendance
web-1  |     + Create model Certificate
web-1  |     + Create model Project
web-1  |     + Create model ProjectCategory
web-1  |     + Create model ProjectCheckinCode
web-1  |     + Create model ProjectImpact
web-1  |     + Create model ProjectSkill
web-1  |   apps/projects/migrations/0002_initial.py
web-1  |     + Add field user to attendance
web-1  |     + Add field user to certificate
web-1  |     + Add field admin to project
web-1  |     + Add field project to certificate
web-1  |     + Add field project to attendance
web-1  |     + Add field category to project
web-1  |     + Add field project to projectcheckincode
web-1  |     + Add field project to projectimpact
web-1  |     + Add field project to projectskill
web-1  |     + Add field skill to projectskill
web-1  |     ~ Alter unique_together for certificate (1 constraint(s))
web-1  |     ~ Alter unique_together for projectskill (1 constraint(s))
web-1  | Migrations for &#39;users&#39;:
web-1  |   apps/users/migrations/0001_initial.py
web-1  |     + Create model Badge
web-1  |     + Create model OTP
web-1  |     + Create model Skill
web-1  |     + Create model User
web-1  |     + Create model UserBadge
web-1  |     + Create model UserSkill
web-1  | Operations to perform:
web-1  |   Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
web-1  | Running migrations:
web-1  |   Applying contenttypes.0001_initial... OK
web-1  |   Applying contenttypes.0002_remove_content_type_name... OK
web-1  |   Applying auth.0001_initial... OK
web-1  |   Applying auth.0002_alter_permission_name_max_length... OK
web-1  |   Applying auth.0003_alter_user_email_max_length... OK
web-1  |   Applying auth.0004_alter_user_username_opts... OK
web-1  |   Applying auth.0005_alter_user_last_login_null... OK
web-1  |   Applying auth.0006_require_contenttypes_0002... OK
web-1  |   Applying auth.0007_alter_validators_add_error_messages... OK
web-1  |   Applying auth.0008_alter_user_username_max_length... OK
web-1  |   Applying auth.0009_alter_user_last_name_max_length... OK
web-1  |   Applying auth.0010_alter_group_name_max_length... OK
web-1  |   Applying auth.0011_update_proxy_permissions... OK
web-1  |   Applying auth.0012_alter_user_first_name_max_length... OK
web-1  |   Applying users.0001_initial... OK
web-1  |   Applying admin.0001_initial... OK
web-1  |   Applying admin.0002_logentry_remove_auto_add... OK
web-1  |   Applying admin.0003_logentry_add_action_flag_choices... OK
web-1  |   Applying authtoken.0001_initial... OK
web-1  |   Applying authtoken.0002_auto_20160226_1747... OK
web-1  |   Applying authtoken.0003_tokenproxy... OK
web-1  |   Applying authtoken.0004_alter_tokenproxy_options... OK
web-1  |   Applying projects.0001_initial... OK
web-1  |   Applying community.0001_initial... OK
web-1  |   Applying community.0002_initial... OK
web-1  |   Applying notifications.0001_initial... OK
web-1  |   Applying notifications.0002_initial... OK
web-1  |   Applying notifications.0003_initial... OK
web-1  |   Applying projects.0002_initial... OK
web-1  |   Applying sessions.0001_initial... OK
web-1  | Traceback (most recent call last):
web-1  |   File &quot;/app/manage.py&quot;, line 22, in &lt;module&gt;
web-1  |     main()
web-1  |   File &quot;/app/manage.py&quot;, line 18, in main
web-1  |     execute_from_command_line(sys.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 442, in execute_from_command_line
web-1  |     utility.execute()
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 436, in execute
web-1  |     self.fetch_command(subcommand).run_from_argv(self.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 416, in run_from_argv
web-1  |     self.execute(*args, **cmd_options)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 460, in execute
web-1  |     output = self.handle(*args, **options)
web-1  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 209, in handle
web-1  |     collected = self.collect()
web-1  |                 ^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 135, in collect
web-1  |     handler(path, prefixed_path, storage)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 368, in copy_file
web-1  |     if not self.delete_file(path, prefixed_path, source_storage):
web-1  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 278, in delete_file
web-1  |     if self.storage.exists(prefixed_path):
web-1  |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/files/storage/filesystem.py&quot;, line 206, in exists
web-1  |     return os.path.lexists(self.path(name))
web-1  |                            ^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/storage.py&quot;, line 39, in path
web-1  |     raise ImproperlyConfigured(
web-1  | django.core.exceptions.ImproperlyConfigured: You&#39;re using the staticfiles app without having set the STATIC_ROOT setting to a filesystem path.
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  |
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 08:08:39
web-1  | Django version 5.2.5, using settings &#39;umugandatech.settings&#39;
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
web-1  |
web-1  | WARNING: This is a development server. Do not use it in a production setting. Use a production WSGI or ASGI server instead.
web-1  | For more information on production servers see: https://docs.djangoproject.com/en/5.2/howto/deployment/
web-1  | /app/umugandatech/settings.py changed, reloading.
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  |
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 08:18:48
web-1  | Django version 5.2.5, using settings &#39;umugandatech.settings&#39;
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
web-1  |
web-1  | WARNING: This is a development server. Do not use it in a production setting. Use a production WSGI or ASGI server instead.
web-1  | For more information on production servers see: https://docs.djangoproject.com/en/5.2/howto/deployment/

---


Perfect! I can see you've added the `STATIC_ROOT = os.path.join(BASE_DIR, 'static')` line. The logs show that Django automatically reloaded after detecting the settings change, and now the server is running cleanly without the staticfiles error.

Your Django application is now fully configured and running successfully at http://0.0.0.0:8000 (accessible at http://localhost:8000).

The setup is complete! You can now:

1. **Visit your app**: http://localhost:8000
2. **Create a superuser**: `docker-compose exec web python manage.py createsuperuser`
3. **Access admin panel**: http://localhost:8000/admin

Your Umuganda community platform backend is ready for development.

---

$ docker-compose logs -f web
web-1  | Waiting for database...
web-1  | Database started
web-1  | Migrations for &#39;community&#39;:
web-1  |   apps/community/migrations/0001_initial.py
web-1  |     + Create model Comment
web-1  |     + Create model Post
web-1  |     + Create model PostUpvote
web-1  |   apps/community/migrations/0002_initial.py
web-1  |     + Add field user to comment
web-1  |     + Add field project to post
web-1  |     + Add field user to post
web-1  |     + Add field post to comment
web-1  |     + Add field post to postupvote
web-1  |     + Add field user to postupvote
web-1  |     ~ Alter unique_together for postupvote (1 constraint(s))
web-1  | Migrations for &#39;notifications&#39;:
web-1  |   apps/notifications/migrations/0001_initial.py
web-1  |     + Create model Notification
web-1  |     + Create model NotificationLog
web-1  |   apps/notifications/migrations/0002_initial.py
web-1  |     + Add field project to notification
web-1  |   apps/notifications/migrations/0003_initial.py
web-1  |     + Add field user to notification
web-1  |     + Add field project to notificationlog
web-1  |     + Add field user to notificationlog
web-1  | Migrations for &#39;projects&#39;:
web-1  |   apps/projects/migrations/0001_initial.py
web-1  |     + Create model Attendance
web-1  |     + Create model Certificate
web-1  |     + Create model Project
web-1  |     + Create model ProjectCategory
web-1  |     + Create model ProjectCheckinCode
web-1  |     + Create model ProjectImpact
web-1  |     + Create model ProjectSkill
web-1  |   apps/projects/migrations/0002_initial.py
web-1  |     + Add field user to attendance
web-1  |     + Add field user to certificate
web-1  |     + Add field admin to project
web-1  |     + Add field project to certificate
web-1  |     + Add field project to attendance
web-1  |     + Add field category to project
web-1  |     + Add field project to projectcheckincode
web-1  |     + Add field project to projectimpact
web-1  |     + Add field project to projectskill
web-1  |     + Add field skill to projectskill
web-1  |     ~ Alter unique_together for certificate (1 constraint(s))
web-1  |     ~ Alter unique_together for projectskill (1 constraint(s))
web-1  | Migrations for &#39;users&#39;:
web-1  |   apps/users/migrations/0001_initial.py
web-1  |     + Create model Badge
web-1  |     + Create model OTP
web-1  |     + Create model Skill
web-1  |     + Create model User
web-1  |     + Create model UserBadge
web-1  |     + Create model UserSkill
web-1  | Operations to perform:
web-1  |   Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
web-1  | Running migrations:
web-1  |   Applying contenttypes.0001_initial... OK
web-1  |   Applying contenttypes.0002_remove_content_type_name... OK
web-1  |   Applying auth.0001_initial... OK
web-1  |   Applying auth.0002_alter_permission_name_max_length... OK
web-1  |   Applying auth.0003_alter_user_email_max_length... OK
web-1  |   Applying auth.0004_alter_user_username_opts... OK
web-1  |   Applying auth.0005_alter_user_last_login_null... OK
web-1  |   Applying auth.0006_require_contenttypes_0002... OK
web-1  |   Applying auth.0007_alter_validators_add_error_messages... OK
web-1  |   Applying auth.0008_alter_user_username_max_length... OK
web-1  |   Applying auth.0009_alter_user_last_name_max_length... OK
web-1  |   Applying auth.0010_alter_group_name_max_length... OK
web-1  |   Applying auth.0011_update_proxy_permissions... OK
web-1  |   Applying auth.0012_alter_user_first_name_max_length... OK
web-1  |   Applying users.0001_initial... OK
web-1  |   Applying admin.0001_initial... OK
web-1  |   Applying admin.0002_logentry_remove_auto_add... OK
web-1  |   Applying admin.0003_logentry_add_action_flag_choices... OK
web-1  |   Applying authtoken.0001_initial... OK
web-1  |   Applying authtoken.0002_auto_20160226_1747... OK
web-1  |   Applying authtoken.0003_tokenproxy... OK
web-1  |   Applying authtoken.0004_alter_tokenproxy_options... OK
web-1  |   Applying projects.0001_initial... OK
web-1  |   Applying community.0001_initial... OK
web-1  |   Applying community.0002_initial... OK
web-1  |   Applying notifications.0001_initial... OK
web-1  |   Applying notifications.0002_initial... OK
web-1  |   Applying notifications.0003_initial... OK
web-1  |   Applying projects.0002_initial... OK
web-1  |   Applying sessions.0001_initial... OK
web-1  | Traceback (most recent call last):
web-1  |   File &quot;/app/manage.py&quot;, line 22, in &lt;module&gt;
web-1  |     main()
web-1  |   File &quot;/app/manage.py&quot;, line 18, in main
web-1  |     execute_from_command_line(sys.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 442, in execute_from_command_line
web-1  |     utility.execute()
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/__init__.py&quot;, line 436, in execute
web-1  |     self.fetch_command(subcommand).run_from_argv(self.argv)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 416, in run_from_argv
web-1  |     self.execute(*args, **cmd_options)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/management/base.py&quot;, line 460, in execute
web-1  |     output = self.handle(*args, **options)
web-1  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 209, in handle
web-1  |     collected = self.collect()
web-1  |                 ^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 135, in collect
web-1  |     handler(path, prefixed_path, storage)
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 368, in copy_file
web-1  |     if not self.delete_file(path, prefixed_path, source_storage):
web-1  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/management/commands/collectstatic.py&quot;, line 278, in delete_file
web-1  |     if self.storage.exists(prefixed_path):
web-1  |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/core/files/storage/filesystem.py&quot;, line 206, in exists
web-1  |     return os.path.lexists(self.path(name))
web-1  |                            ^^^^^^^^^^^^^^^
web-1  |   File &quot;/usr/local/lib/python3.11/site-packages/django/contrib/staticfiles/storage.py&quot;, line 39, in path
web-1  |     raise ImproperlyConfigured(
web-1  | django.core.exceptions.ImproperlyConfigured: You&#39;re using the staticfiles app without having set the STATIC_ROOT setting to a filesystem path.
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  |
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 08:08:39
web-1  | Django version 5.2.5, using settings &#39;umugandatech.settings&#39;
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
web-1  |
web-1  | WARNING: This is a development server. Do not use it in a production setting. Use a production WSGI or ASGI server instead.
web-1  | For more information on production servers see: https://docs.djangoproject.com/en/5.2/howto/deployment/
web-1  | /app/umugandatech/settings.py changed, reloading.
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  |
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 08:18:48
web-1  | Django version 5.2.5, using settings &#39;umugandatech.settings&#39;
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
web-1  |
web-1  | WARNING: This is a development server. Do not use it in a production setting. Use a production WSGI or ASGI server instead.
web-1  | For more information on production servers see: https://docs.djangoproject.com/en/5.2/howto/deployment/    what a next to my docker

---


Your Docker setup is working perfectly! The server is running at http://0.0.0.0:8000. The staticfiles error in the logs doesn't prevent the server from running - it's just a warning during startup.

**Next steps for your Docker setup:**

1. **Create a superuser:**
```bash
docker-compose exec web python manage.py createsuperuser
```

2. **Test your application:**
- Visit http://localhost:8000
- Visit http://localhost:8000/admin (after creating superuser)

3. **Optional improvements to your Docker setup:**

Add to your docker-compose.yml to fix the staticfiles issue:
```yaml
web:
  build: .
  command: sh -c "python manage.py collectstatic --noinput && python manage.py runserver 0.0.0.0:8000"
```

4. **Development workflow:**
```bash
# View all logs
docker-compose logs -f

# Restart after code changes
docker-compose restart web

# Stop services
docker-compose down
```

Your Umuganda platform backend is fully containerized and ready for development!

---

okay generate for me the documentation about docker and how i will re run it after changing some codes. you must insert all information i may use while dealing with docker

---


# Docker Documentation for Umuganda Tech Backend

## Overview
This documentation covers all Docker operations for the Umuganda community platform backend project.

## Project Structure
```
capstone-umuganda-tech-backend/
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
├── manage.py
├── umugandatech/
│   └── settings.py
└── apps/
    ├── community/
    ├── users/
    ├── projects/
    └── notifications/
```

## Services Configuration

### Database Service (PostgreSQL)
- **Image**: postgres:15
- **Port**: 5432
- **Database**: umuganda_db
- **User**: umuganda_user
- **Password**: StrongPassword123

### Web Service (Django)
- **Port**: 8000
- **URL**: http://localhost:8000
- **Admin**: http://localhost:8000/admin

## Basic Docker Commands

### Starting the Application
```bash
# Start all services in background
docker-compose up -d

# Start with logs visible
docker-compose up

# Start specific service
docker-compose up web
```

### Stopping the Application
```bash
# Stop all services
docker-compose down

# Stop and remove volumes (WARNING: deletes database data)
docker-compose down -v

# Stop specific service
docker-compose stop web
```

### Viewing Logs
```bash
# View all logs
docker-compose logs

# Follow logs in real-time
docker-compose logs -f

# View specific service logs
docker-compose logs -f web
docker-compose logs -f db

# View last 50 lines
docker-compose logs --tail=50 web
```

## Development Workflow

### After Code Changes

#### 1. Python Code Changes (Views, Models, etc.)
Django auto-reloads, no restart needed:
```bash
# Just save your files - Django will auto-reload
# Check logs to confirm reload
docker-compose logs -f web
```

#### 2. Settings Changes
```bash
# Django auto-reloads for settings.py changes
# No manual restart needed
```

#### 3. Requirements Changes (New packages)
```bash
# Rebuild the web container
docker-compose build web
docker-compose up -d web
```

#### 4. Dockerfile Changes
```bash
# Rebuild all containers
docker-compose build
docker-compose up -d
```

#### 5. Docker-compose.yml Changes
```bash
# Recreate containers with new configuration
docker-compose down
docker-compose up -d
```

### Database Operations

#### Migrations
```bash
# Create new migrations
docker-compose exec web python manage.py makemigrations

# Apply migrations
docker-compose exec web python manage.py migrate

# Check migration status
docker-compose exec web python manage.py showmigrations
```

#### Database Management
```bash
# Create superuser
docker-compose exec web python manage.py createsuperuser

# Access Django shell
docker-compose exec web python manage.py shell

# Access database shell
docker-compose exec web python manage.py dbshell

# Reset database (WARNING: deletes all data)
docker-compose down -v
docker-compose up -d
```

### Static Files
```bash
# Collect static files
docker-compose exec web python manage.py collectstatic

# Clear static files
docker-compose exec web python manage.py collectstatic --clear
```

## Testing

### Running Tests
```bash
# Run all tests
docker-compose exec web python manage.py test

# Run specific app tests
docker-compose exec web python manage.py test apps.users

# Run with coverage
docker-compose exec web coverage run manage.py test
docker-compose exec web coverage report
```

## Debugging and Troubleshooting

### Container Status
```bash
# Check running containers
docker-compose ps

# Check container health
docker-compose exec web python manage.py check

# System check
docker-compose exec web python manage.py check --deploy
```

### Access Container Shell
```bash
# Access web container bash
docker-compose exec web bash

# Access database container
docker-compose exec db psql -U umuganda_user -d umuganda_db
```

### Common Issues and Solutions

#### 1. Service Not Running
```bash
# Check if containers are running
docker-compose ps

# Start services
docker-compose up -d

# Check logs for errors
docker-compose logs web
```

#### 2. Database Connection Issues
```bash
# Check database health
docker-compose exec db pg_isready -U umuganda_user -d umuganda_db

# Restart database
docker-compose restart db
```

#### 3. Port Already in Use
```bash
# Check what's using port 8000
netstat -tulpn | grep :8000

# Kill process using port
sudo kill -9 <PID>

# Or change port in docker-compose.yml
ports:
  - "8001:8000"  # Use port 8001 instead
```

#### 4. Permission Issues
```bash
# Fix file permissions
sudo chown -R $USER:$USER .

# Rebuild containers
docker-compose build --no-cache
```

## Data Management

### Backup Database
```bash
# Create database backup
docker-compose exec db pg_dump -U umuganda_user umuganda_db > backup.sql

# Restore database
docker-compose exec -T db psql -U umuganda_user -d umuganda_db < backup.sql
```

### Volume Management
```bash
# List volumes
docker volume ls

# Inspect volume
docker volume inspect capstone-umuganda-tech-backend_postgres_data

# Remove unused volumes
docker volume prune
```

## Performance and Monitoring

### Resource Usage
```bash
# Check container resource usage
docker stats

# Check specific container
docker stats capstone-umuganda-tech-backend-web-1
```

### Container Information
```bash
# Inspect container
docker inspect capstone-umuganda-tech-backend-web-1

# Check container processes
docker-compose exec web ps aux
```

## Production Considerations

### Environment Variables
Create `.env` file for production:
```env
DEBUG=False
SECRET_KEY=your-production-secret-key
DB_PASSWORD=your-secure-password
ALLOWED_HOSTS=your-domain.com
```

### Security
```bash
# Remove development settings
CORS_ALLOW_ALL_ORIGINS = False  # In settings.py
DEBUG = False  # In settings.py

# Use production WSGI server
# Update docker-compose.yml command:
command: gunicorn umugandatech.wsgi:application --bind 0.0.0.0:8000
```

## Quick Reference Commands

```bash
# Daily development workflow
docker-compose up -d                    # Start services
docker-compose logs -f web             # Monitor logs
docker-compose exec web python manage.py shell  # Django shell
docker-compose down                     # Stop services

# After major changes
docker-compose build                    # Rebuild containers
docker-compose up -d --force-recreate  # Force recreate containers

# Emergency reset
docker-compose down -v                  # Stop and remove all data
docker system prune -a                 # Clean up Docker system
```

## URLs and Access Points

- **Application**: http://localhost:8000
- **Admin Panel**: http://localhost:8000/admin
- **API Endpoints**: http://localhost:8000/api/
- **Database**: localhost:5432

## File Locations in Container

- **Application Code**: `/app/`
- **Static Files**: `/app/static/`
- **Media Files**: `/app/media/`
- **Database Data**: `/var/lib/postgresql/data/`

This documentation covers all essential Docker operations for your Umuganda Tech backend development workflow.

---

please i need well explained documentation in way i will undestand it  if it&#39;s possible please make it downloadable pdf or word file

---

I understand you want a comprehensive, easy-to-understand documentation. While I can't directly create downloadable PDF or Word files in this environment, I can create a detailed documentation file that you can easily copy and save. Let me create a comprehensive Docker documentation file for you.

---


Now I'll create a comprehensive, beginner-friendly Docker documentation file that you can save as a Word document or PDF:

# 🐳 UMUGANDA TECH BACKEND - DOCKER COMPLETE GUIDE

## 📋 TABLE OF CONTENTS
1. [What is Docker and Why We Use It](#what-is-docker)
2. [Understanding Your Project Setup](#project-setup)
3. [Getting Started - First Time Setup](#first-time-setup)
4. [Daily Development Workflow](#daily-workflow)
5. [After Making Code Changes](#code-changes)
6. [Database Operations](#database-operations)
7. [Troubleshooting Common Issues](#troubleshooting)
8. [Useful Commands Reference](#commands-reference)
9. [Understanding Logs](#understanding-logs)
10. [Production Deployment](#production)

---

## 🤔 WHAT IS DOCKER AND WHY WE USE IT {#what-is-docker}

### What is Docker?
Docker is like a **virtual container** for your application. Think of it as a **lunch box** that contains everything your application needs to run:
- Your Django code
- Python and all required packages
- PostgreSQL database
- All configurations

### Why Use Docker?
✅ **Consistency**: Works the same on your computer, your teammate's computer, and production servers  
✅ **Easy Setup**: No need to install Python, PostgreSQL, or manage virtual environments  
✅ **Isolation**: Your project won't conflict with other projects  
✅ **Easy Deployment**: Deploy anywhere with one command  

### Key Concepts:
- **Container**: A running instance of your application
- **Image**: A blueprint for creating containers
- **docker-compose.yml**: Configuration file that defines your services
- **Service**: A component of your application (web app, database, etc.)

---

## 🏗️ UNDERSTANDING YOUR PROJECT SETUP {#project-setup}

Your project has **2 main services**:

### 1. **Database Service (db)**
- **What it does**: Stores all your data (users, projects, posts, etc.)
- **Technology**: PostgreSQL 15
- **Port**: 5432
- **Database Name**: umuganda_db
- **Username**: umuganda_user
- **Password**: StrongPassword123

### 2. **Web Service (web)**
- **What it does**: Runs your Django application
- **Port**: 8000
- **URL**: http://localhost:8000
- **Admin Panel**: http://localhost:8000/admin

### Project Structure:
```
capstone-umuganda-tech-backend/
├── docker-compose.yml          # Main configuration file
├── dockerfile                  # Instructions to build web container
├── requirements.txt           # Python packages needed
├── manage.py                  # Django management script
├── apps/                      # Your Django apps
│   ├── community/            # Community features
│   ├── users/                # User management
│   ├── projects/             # Project management
│   └── notifications/        # Notification system
└── umugandatech/             # Main Django settings
    └── settings.py           # Configuration file
```

---

## 🚀 GETTING STARTED - FIRST TIME SETUP {#first-time-setup}

### Step 1: Open Terminal/Command Prompt
Navigate to your project folder:
```bash
cd c:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend
```

### Step 2: Start Your Application
```bash
docker-compose up -d
```
**What this does:**
- `-d` means "detached mode" (runs in background)
- Starts both database and web services
- Downloads required images if first time
- Creates containers and networks

### Step 3: Check if Everything is Running
```bash
docker-compose ps
```
**You should see:**
```
NAME                                    COMMAND                  SERVICE   STATUS    PORTS
capstone-umuganda-tech-backend-db-1     "docker-entrypoint.s…"   db        Up        0.0.0.0:5432->5432/tcp
capstone-umuganda-tech-backend-web-1    "python manage.py ru…"   web       Up        0.0.0.0:8000->8000/tcp
```

### Step 4: Create Your First Admin User
```bash
docker-compose exec web python manage.py createsuperuser
```
**Follow the prompts to create:**
- Username
- Email
- Password

### Step 5: Test Your Application
Open your browser and visit:
- **Main App**: http://localhost:8000
- **Admin Panel**: http://localhost:8000/admin (login with superuser credentials)

**🎉 Congratulations! Your application is now running!**

---

## 💼 DAILY DEVELOPMENT WORKFLOW {#daily-workflow}

### Starting Your Day:
```bash
# 1. Navigate to project folder
cd c:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend

# 2. Start services
docker-compose up -d

# 3. Check logs to ensure everything is working
docker-compose logs -f web
```

### During Development:
```bash
# View real-time logs (helpful for debugging)
docker-compose logs -f web

# Stop logs viewing (press Ctrl+C)
```

### Ending Your Day:
```bash
# Stop all services
docker-compose down
```

**💡 Pro Tip**: You can leave Docker running overnight if you want. It won't harm your computer.

---

## 🔄 AFTER MAKING CODE CHANGES {#code-changes}

### 1. **Regular Code Changes** (Views, Models, Templates)
**Good News**: Django automatically detects changes and reloads!

**What to do**: 
- Just save your files
- Refresh your browser
- Check logs if something seems wrong:
```bash
docker-compose logs -f web
```

### 2. **Database Model Changes**
When you modify models in `apps/users/models.py`, `apps/projects/models.py`, etc.:

```bash
# Step 1: Create migration files
docker-compose exec web python manage.py makemigrations

# Step 2: Apply migrations to database
docker-compose exec web python manage.py migrate
```

**Example Output:**
```
Migrations for 'users':
  apps/users/migrations/0002_user_phone_number.py
    - Add field phone_number to user
```

### 3. **Settings Changes** (settings.py)
**Good News**: Django automatically reloads settings changes!

**What to do**:
- Save your settings.py file
- Check logs to confirm reload:
```bash
docker-compose logs -f web
```

### 4. **New Python Package Requirements**
When you add new packages to `requirements.txt`:

```bash
# Rebuild the web container
docker-compose build web

# Restart with new packages
docker-compose up -d web
```

### 5. **Docker Configuration Changes**
When you modify `docker-compose.yml` or `dockerfile`:

```bash
# Stop everything
docker-compose down

# Rebuild everything
docker-compose build

# Start with new configuration
docker-compose up -d
```

---

## 🗄️ DATABASE OPERATIONS {#database-operations}

### Creating and Managing Users
```bash
# Create superuser (admin)
docker-compose exec web python manage.py createsuperuser

# Create regular user (through Django shell)
docker-compose exec web python manage.py shell
```

### Database Migrations
```bash
# Check current migration status
docker-compose exec web python manage.py showmigrations

# Create new migrations after model changes
docker-compose exec web python manage.py makemigrations

# Apply migrations
docker-compose exec web python manage.py migrate

# Apply migrations for specific app
docker-compose exec web python manage.py migrate users
```

### Database Shell Access
```bash
# Django shell (Python with Django loaded)
docker-compose exec web python manage.py shell

# Direct database access
docker-compose exec web python manage.py dbshell

# PostgreSQL shell
docker-compose exec db psql -U umuganda_user -d umuganda_db
```

### Database Backup and Restore
```bash
# Create backup
docker-compose exec db pg_dump -U umuganda_user umuganda_db > backup_$(date +%Y%m%d).sql

# Restore from backup
docker-compose exec -T db psql -U umuganda_user -d umuganda_db < backup_20240911.sql
```

---

## 🔧 TROUBLESHOOTING COMMON ISSUES {#troubleshooting}

### Issue 1: "Service web is not running"
**Problem**: Container stopped or failed to start

**Solution**:
```bash
# Check what's running
docker-compose ps

# Start services
docker-compose up -d

# Check logs for errors
docker-compose logs web
```

### Issue 2: "Port 8000 is already in use"
**Problem**: Another application is using port 8000

**Solutions**:
```bash
# Option 1: Find and kill the process
netstat -ano | findstr :8000
taskkill /PID <PID_NUMBER> /F

# Option 2: Change port in docker-compose.yml
# Edit docker-compose.yml and change:
ports:
  - "8001:8000"  # Use port 8001 instead
```

### Issue 3: Database Connection Errors
**Problem**: Web service can't connect to database

**Solution**:
```bash
# Check database health
docker-compose exec db pg_isready -U umuganda_user -d umuganda_db

# Restart database
docker-compose restart db

# Check database logs
docker-compose logs db
```

### Issue 4: "No such file or directory" Errors
**Problem**: File path issues or missing files

**Solution**:
```bash
# Make sure you're in the right directory
pwd
cd c:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend

# Check if docker-compose.yml exists
ls docker-compose.yml
```

### Issue 5: Permission Denied Errors
**Problem**: File permission issues

**Solution**:
```bash
# Fix file permissions (Linux/Mac)
sudo chown -R $USER:$USER .

# Rebuild containers
docker-compose build --no-cache
```

### Issue 6: Out of Disk Space
**Problem**: Docker images taking too much space

**Solution**:
```bash
# Clean up unused Docker resources
docker system prune -a

# Remove unused volumes
docker volume prune
```

---

## 📚 USEFUL COMMANDS REFERENCE {#commands-reference}

### Starting and Stopping
```bash
# Start all services in background
docker-compose up -d

# Start with logs visible
docker-compose up

# Stop all services
docker-compose down

# Stop and remove all data (⚠️ WARNING: Deletes database!)
docker-compose down -v

# Restart specific service
docker-compose restart web
```

### Viewing Information
```bash
# Check running containers
docker-compose ps

# View logs
docker-compose logs
docker-compose logs -f web          # Follow web logs
docker-compose logs --tail=50 web   # Last 50 lines

# Check resource usage
docker stats
```

### Building and Updating
```bash
# Rebuild containers
docker-compose build

# Rebuild without cache
docker-compose build --no-cache

# Pull latest images
docker-compose pull
```

### Executing Commands
```bash
# Run Django commands
docker-compose exec web python manage.py <command>

# Access container shell
docker-compose exec web bash

# Run one-time commands
docker-compose run web python manage.py test
```

### Testing
```bash
# Run all tests
docker-compose exec web python manage.py test

# Run specific app tests
docker-compose exec web python manage.py test apps.users

# Run with verbose output
docker-compose exec web python manage.py test --verbosity=2
```

---

## 📊 UNDERSTANDING LOGS {#understanding-logs}

### Reading Log Messages

**Normal Startup Logs:**
```
web-1  | Waiting for database...
web-1  | Database started
web-1  | Performing system checks...
web-1  | System check identified no issues (0 silenced).
web-1  | Starting development server at http://0.0.0.0:8000/
```

**Migration Logs:**
```
web-1  | Running migrations:
web-1  |   Applying contenttypes.0001_initial... OK
web-1  |   Applying users.0001_initial... OK
```

**Error Logs to Watch For:**
```
web-1  | django.db.utils.OperationalError: could not connect to server
web-1  | ModuleNotFoundError: No module named 'some_package'
web-1  | django.core.exceptions.ImproperlyConfigured
```

### Log Commands
```bash
# View all logs
docker-compose logs

# Follow logs in real-time
docker-compose logs -f

# View specific service logs
docker-compose logs web
docker-compose logs db

# View last N lines
docker-compose logs --tail=100 web

# View logs with timestamps
docker-compose logs -t web
```

---

## 🚀 PRODUCTION DEPLOYMENT {#production}

### Environment Configuration
Create `.env.production` file:
```env
DEBUG=False
SECRET_KEY=your-super-secure-production-key-here
DB_PASSWORD=your-secure-database-password
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
CORS_ALLOW_ALL_ORIGINS=False
```

### Production Docker Compose
Create `docker-compose.prod.yml`:
```yaml
services:
  web:
    build: .
    command: gunicorn umugandatech.wsgi:application --bind 0.0.0.0:8000
    environment:
      - DEBUG=False
    # ... other production settings
```

### Deployment Commands
```bash
# Build for production
docker-compose -f docker-compose.prod.yml build

# Deploy to production
docker-compose -f docker-compose.prod.yml up -d

# Collect static files for production
docker-compose -f docker-compose.prod.yml exec web python manage.py collectstatic --noinput
```

---

## 🆘 EMERGENCY PROCEDURES

### Complete Reset (⚠️ WARNING: Deletes all data!)
```bash
# Stop everything
docker-compose down -v

# Remove all containers and images
docker system prune -a

# Start fresh
docker-compose up -d

# Recreate superuser
docker-compose exec web python manage.py createsuperuser
```

### Quick Health Check
```bash
# Check if services are running
docker-compose ps

# Check application health
curl http://localhost:8000

# Check database connection
docker-compose exec web python manage.py check --database default
```

---

## 📞 GETTING HELP

### Where to Look for Solutions:
1. **Check logs first**: `docker-compose logs -f web`
2. **Google the exact error message**
3. **Check Django documentation**: https://docs.djangoproject.com/
4. **Check Docker documentation**: https://docs.docker.com/
5. **Stack Overflow**: Search for your specific error

### Common Search Terms:
- "Django docker-compose [your error]"
- "PostgreSQL docker connection refused"
- "Django migration error [specific error]"

---

## 💡 BEST PRACTICES

### Do's:
✅ Always check logs when something goes wrong  
✅ Commit your code before major Docker changes  
✅ Use `docker-compose down` before shutting down your computer  
✅ Regularly backup your database  
✅ Keep your requirements.txt updated  

### Don'ts:
❌ Don't use `docker-compose down -v` unless you want to delete data  
❌ Don't modify files inside containers directly  
❌ Don't ignore error messages in logs  
❌ Don't run multiple instances on the same ports  

---

## 📝 QUICK REFERENCE CARD

**Copy this section and keep it handy!**

```bash
# Daily workflow
docker-compose up -d              # Start
docker-compose logs -f web        # Monitor
docker-compose down               # Stop

# After code changes
# (Most changes auto-reload, just save files)

# After model changes
docker-compose exec web python manage.py makemigrations
docker-compose exec web python manage.py migrate

# After requirements.txt changes
docker-compose build web
docker-compose up -d web

# Troubleshooting
docker-compose ps                 # Check status
docker-compose logs web           # Check errors
docker-compose restart web        # Restart service

# Database operations
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py shell
docker-compose exec web python manage.py dbshell

# Emergency reset (⚠️ Deletes data!)
docker-compose down -v
docker-compose up -d
```

---

**🎯 Remember**: Docker makes your development life easier once you understand the basics. Don't be afraid to experiment - you can always reset and start fresh!

**📧 Need Help?** Save this document and refer to it whenever you're working with Docker. The more you use these commands, the more natural they'll become.

---

*This documentation was created for the Umuganda Tech Backend project. Keep it updated as your project evolves!*

---

To save this as a Word document or PDF:

1. **Copy all the text above**
2. **Open Microsoft Word or Google Docs**
3. **Paste the content**
4. **Format it nicely** (the markdown formatting will need to be converted to proper headings and formatting)
5. **Save as PDF or Word document**

Alternatively, you can:
- Save it as a `.md` file and use online markdown to PDF converters
- Use tools like Pandoc to convert markdown to PDF
- Copy sections as needed into your preferred document format

This documentation covers everything you need to know about working with Docker for your Umuganda Tech project, explained in simple terms with practical examples!

---

can you improve it and try to explain it in details  than how did it

---

I'll create a much more detailed and comprehensive Docker documentation that explains everything step-by-step with real-world analogies and examples. Let me check your project files first to make it more specific to your setup.

---


Now I'll create an extremely detailed and comprehensive Docker documentation:

# 🐳 UMUGANDA TECH BACKEND - COMPLETE DOCKER MASTERY GUIDE

## 📚 TABLE OF CONTENTS
1. [Understanding Docker - The Complete Picture](#understanding-docker)
2. [Your Project Architecture Deep Dive](#project-architecture)
3. [File-by-File Breakdown](#file-breakdown)
4. [Step-by-Step First Setup](#first-setup)
5. [Understanding What Happens Behind the Scenes](#behind-scenes)
6. [Development Workflow - Every Scenario Covered](#development-workflow)
7. [Database Operations - Complete Guide](#database-guide)
8. [Troubleshooting - Every Problem Solved](#troubleshooting)
9. [Advanced Docker Operations](#advanced-operations)
10. [Production Deployment Guide](#production-guide)
11. [Performance Optimization](#performance)
12. [Security Best Practices](#security)

---

## 🎯 UNDERSTANDING DOCKER - THE COMPLETE PICTURE {#understanding-docker}

### What is Docker? (Real-World Analogy)

Imagine you're moving to a new apartment. Instead of packing individual items, you use **standardized shipping containers**. Each container has everything you need for a specific room - bedroom container has bed, clothes, lamp; kitchen container has stove, dishes, food.

**Docker works the same way:**
- **Container** = Your shipping container (has everything your app needs)
- **Image** = The blueprint/template for packing the container
- **Docker Compose** = The moving coordinator that manages multiple containers
- **Volume** = Permanent storage that survives even if containers are replaced

### Why Docker Solves Real Problems

**Problem 1: "It works on my machine"**
```
Developer A: "My code works fine!"
Developer B: "It crashes on my computer!"
```
**Docker Solution**: Everyone uses the exact same environment

**Problem 2: Complex Setup**
```
Without Docker: Install Python 3.11 → Install PostgreSQL → Create database → Install 50+ packages → Configure everything
With Docker: Run one command: docker-compose up -d
```

**Problem 3: Environment Conflicts**
```
Project A needs Python 3.8, Project B needs Python 3.11
Project A needs PostgreSQL 12, Project B needs PostgreSQL 15
```
**Docker Solution**: Each project runs in isolation

### Docker Components in Your Project

#### 1. **Docker Images** (The Blueprints)
```
postgres:15     → Ready-made PostgreSQL database
python:3.11     → Ready-made Python environment
Your web image  → Your Django app (built from Dockerfile)
```

#### 2. **Docker Containers** (The Running Applications)
```
db container    → Running PostgreSQL database
web container   → Running Django application
```

#### 3. **Docker Volumes** (Permanent Storage)
```
postgres_data   → Database files (survives container restarts)
media_volume    → User uploaded files (images, documents)
static_volume   → CSS, JavaScript, images for your website
```

#### 4. **Docker Networks** (Communication Channels)
```
Default network → Allows web container to talk to db container
```

---

## 🏗️ YOUR PROJECT ARCHITECTURE DEEP DIVE {#project-architecture}

### The Big Picture

Your Umuganda Tech project is like a **restaurant**:

```
🏢 RESTAURANT (Your Application)
├── 👨‍🍳 Kitchen (Web Service - Django)
│   ├── Cooks (Django views)
│   ├── Recipes (Django models)
│   ├── Ingredients (Python packages)
│   └── Menu (API endpoints)
│
└── 🗄️ Storage Room (Database Service - PostgreSQL)
    ├── User accounts
    ├── Community posts
    ├── Project data
    └── Notifications
```

### Service Breakdown

#### **Database Service (db)**
```yaml
db:
  image: postgres:15                    # Uses official PostgreSQL version 15
  volumes:
    - postgres_data:/var/lib/postgresql/data/  # Permanent storage
  environment:
    POSTGRES_DB: umuganda_db           # Database name
    POSTGRES_USER: umuganda_user       # Database username
    POSTGRES_PASSWORD: StrongPassword123  # Database password
  ports:
    - "5432:5432"                      # Port mapping: your_computer:container
  healthcheck:                         # Checks if database is ready
    test: ["CMD-SHELL", "pg_isready -U umuganda_user -d umuganda_db"]
    interval: 30s                      # Check every 30 seconds
    timeout: 10s                       # Wait 10 seconds for response
    retries: 3                         # Try 3 times before giving up
```

**What this means:**
- **Image**: Downloads PostgreSQL 15 from Docker Hub
- **Volumes**: Your database data is saved permanently
- **Environment**: Sets up database name, user, and password
- **Ports**: Maps port 5432 on your computer to port 5432 in container
- **Healthcheck**: Makes sure database is working before starting web service

#### **Web Service (web)**
```yaml
web:
  build: .                             # Build from Dockerfile in current directory
  command: python manage.py runserver 0.0.0.0:8000  # Command to start Django
  volumes:
    - .:/app                           # Your code folder → container's /app folder
    - media_volume:/app/media          # Permanent storage for uploaded files
    - static_volume:/app/static        # Permanent storage for CSS/JS files
  ports:
    - "8000:8000"                      # Port mapping: your_computer:container
  environment:                         # Environment variables for Django
    - DEBUG=True
    - SECRET_KEY=django-insecure-y$$4=58&b=^z9n$$^c(f6j0_^^3@9g)ub=z^=5z)o2^qbd13uw!_
    - DB_ENGINE=django.db.backends.postgresql
    - DB_NAME=umuganda_db
    - DB_USER=umuganda_user
    - DB_PASSWORD=StrongPassword123
    - DB_HOST=db                       # Points to db service (not localhost!)
    - DB_PORT=5432
  depends_on:
    db:
      condition: service_healthy       # Wait for database to be ready
```

**What this means:**
- **Build**: Creates your Django container using Dockerfile
- **Command**: Starts Django development server
- **Volumes**: 
  - Your code is synced (changes reflect immediately)
  - Media and static files are stored permanently
- **Environment**: All Django settings as environment variables
- **Depends_on**: Web service waits for database to be healthy

---

## 📁 FILE-BY-FILE BREAKDOWN {#file-breakdown}

### 1. **docker-compose.yml** (The Orchestra Conductor)

This file is like a **recipe book** that tells Docker how to prepare your entire application:

```yaml
# Think of this as: "How to set up my restaurant"

services:                              # Different parts of your restaurant
  db:                                  # The storage room
    image: postgres:15                 # Use PostgreSQL version 15
    # ... database configuration
  
  web:                                 # The kitchen
    build: .                           # Build from instructions in Dockerfile
    # ... web application configuration

volumes:                               # Permanent storage areas
  postgres_data:                       # Database files storage
  media_volume:                        # User uploaded files storage
  static_volume:                       # Website assets storage
```

### 2. **Dockerfile** (The Kitchen Setup Instructions)

This file is like **detailed instructions for setting up your kitchen**:

```dockerfile
FROM python:3.11-slim                  # Start with Python 3.11 base

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1          # Don't create .pyc files
ENV PYTHONUNBUFFERED=1                 # Show Python output immediately

WORKDIR /app                           # Set /app as working directory

# Install system dependencies (like installing kitchen equipment)
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        postgresql-client \            # To connect to PostgreSQL
        build-essential \              # For compiling Python packages
        libpq-dev \                    # PostgreSQL development files
        netcat-traditional \           # For checking if database is ready
    && rm -rf /var/lib/apt/lists/*     # Clean up to reduce image size

# Install Python dependencies (like stocking ingredients)
COPY requirements.txt /app/
RUN pip install --no-cache-dir -r requirements.txt

# Copy entrypoint script (startup procedures)
COPY entrypoint.sh /app/
RUN chmod +x /app/entrypoint.sh        # Make script executable

# Copy project files (your recipes and cooking instructions)
COPY . /app/

# Create directories for media and static files
RUN mkdir -p /app/media /app/static

EXPOSE 8000                            # Tell Docker this container uses port 8000

ENTRYPOINT ["/app/entrypoint.sh"]      # Run startup script first
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]  # Default command
```

### 3. **entrypoint.sh** (The Opening Procedures)

This script is like **the opening checklist for your restaurant**:

```bash
#!/bin/bash

# Wait for database to be ready (like waiting for the storage room to be unlocked)
echo "Waiting for database..."
while ! nc -z db 5432; do             # Keep checking if database is responding
  sleep 0.1                            # Wait 0.1 seconds between checks
done
echo "Database started"

# Run migrations (like setting up your storage system)
python manage.py makemigrations        # Create migration files if needed
python manage.py migrate               # Apply database changes

# Collect static files (like organizing your serving dishes)
python manage.py collectstatic --noinput

# Start server (open the restaurant!)
exec "$@"                              # Run the command passed to this script
```

---

## 🚀 STEP-BY-STEP FIRST SETUP {#first-setup}

### Prerequisites Check

Before starting, make sure you have:
- **Docker Desktop** installed and running
- **Git Bash** or **Command Prompt** or **PowerShell**
- Your project folder accessible

### Step 1: Navigate to Your Project (Detailed)

**Option A: Using File Explorer + Command Prompt**
1. Open File Explorer
2. Navigate to: `C:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend`
3. Click in the address bar
4. Type `cmd` and press Enter
5. Command Prompt opens in the correct folder

**Option B: Using Command Prompt Directly**
```cmd
# Open Command Prompt (Windows + R, type cmd, press Enter)
cd /d C:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend

# Verify you're in the right place
dir
# You should see: docker-compose.yml, dockerfile, manage.py, etc.
```

**Option C: Using PowerShell**
```powershell
# Open PowerShell (Windows + X, select PowerShell)
Set-Location "C:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend"

# Verify location
Get-ChildItem
# You should see your project files
```

### Step 2: Understanding What Will Happen

When you run `docker-compose up -d`, here's the **exact sequence**:

```
1. Docker reads docker-compose.yml
2. Checks if postgres:15 image exists locally
   ├─ If not: Downloads from Docker Hub (~100MB)
   └─ If yes: Uses local copy
3. Creates postgres_data volume for database storage
4. Starts db container with PostgreSQL
5. Runs health check every 30 seconds until database is ready
6. Builds web container from Dockerfile:
   ├─ Downloads python:3.11-slim base image (~50MB)
   ├─ Installs system packages (postgresql-client, etc.)
   ├─ Installs Python packages from requirements.txt
   ├─ Copies your project files
   └─ Sets up entrypoint script
7. Starts web container
8. entrypoint.sh script runs:
   ├─ Waits for database to respond
   ├─ Creates/applies database migrations
   ├─ Collects static files
   └─ Starts Django development server
9. Your application is ready at http://localhost:8000
```

### Step 3: First Run (With Detailed Output Explanation)

```bash
docker-compose up -d
```

**Expected Output and What It Means:**

```
[+] Running 0/3
 ⠿ Network capstone-umuganda-tech-backend_default  Created    0.1s
```
*Creates a network for your containers to communicate*

```
[+] Building 45.2s (15/15) FINISHED
 => [internal] load build definition from dockerfile           0.1s
 => => transferring dockerfile: 32B                            0.0s
```
*Docker is reading your Dockerfile*

```
 => [internal] load .dockerignore                              0.1s
 => => transferring context: 2B                                0.0s
```
*Checking which files to ignore when building*

```
 => [internal] load metadata for docker.io/library/python:3.11-slim  2.3s
```
*Getting information about Python 3.11 base image*

```
 => [1/9] FROM docker.io/library/python:3.11-slim@sha256:...  15.2s
```
*Downloading Python 3.11 base image (first time only)*

```
 => [internal] load build context                              0.2s
 => => transferring context: 1.23MB                            0.2s
```
*Copying your project files into the build context*

```
 => [2/9] RUN apt-get update && apt-get install -y...         12.1s
```
*Installing system dependencies (PostgreSQL client, build tools)*

```
 => [3/9] COPY requirements.txt /app/                          0.1s
 => [4/9] RUN pip install --no-cache-dir -r requirements.txt  8.3s
```
*Installing Python packages (Django, PostgreSQL adapter, etc.)*

```
 => [5/9] COPY entrypoint.sh /app/                             0.1s
 => [6/9] RUN chmod +x /app/entrypoint.sh                      0.2s
 => [7/9] COPY . /app/                                         0.3s
 => [8/9] RUN mkdir -p /app/media /app/static                  0.2s
 => exporting to image                                         1.1s
```
*Finalizing the container image*

```
[+] Running 3/3
 ✔ Volume "capstone-umuganda-tech-backend_postgres_data"  Created    0.0s
 ✔ Container capstone-umuganda-tech-backend-db-1         Healthy    30.1s
 ✔ Container capstone-umuganda-tech-backend-web-1        Started    30.2s
```
*All services are now running!*

### Step 4: Verify Everything is Working

```bash
# Check container status
docker-compose ps
```

**Expected Output:**
```
NAME                                    COMMAND                  SERVICE   STATUS    PORTS
capstone-umuganda-tech-backend-db-1     "docker-entrypoint.s…"   db        Up        0.0.0.0:5432->5432/tcp
capstone-umuganda-tech-backend-web-1    "/app/entrypoint.sh …"   web       Up        0.0.0.0:8000->8000/tcp
```

**What this means:**
- **db-1**: Database container is running, accessible on port 5432
- **web-1**: Web container is running, accessible on port 8000
- **STATUS Up**: Both containers are healthy and running

### Step 5: Check the Logs (Understanding What's Happening)

```bash
docker-compose logs -f web
```

**Expected Log Output and Explanations:**

```
web-1  | Waiting for database...
```
*entrypoint.sh is checking if database is ready*

```
web-1  | Database started
```
*Database responded successfully*

```
web-1  | Migrations for 'community':
web-1  |   apps/community/migrations/0001_initial.py
web-1  |     + Create model Comment
web-1  |     + Create model Post
web-1  |     + Create model PostUpvote
```
*Django is creating database tables for your community app*

```
web-1  | Migrations for 'users':
web-1  |   apps/users/migrations/0001_initial.py
web-1  |     + Create model User
web-1  |     + Create model UserBadge
web-1  |     + Create model UserSkill
```
*Creating tables for user management*

```
web-1  | Operations to perform:
web-1  |   Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
web-1  | Running migrations:
web-1  |   Applying contenttypes.0001_initial... OK
web-1  |   Applying users.0001_initial... OK
web-1  |   Applying projects.0001_initial... OK
```
*Actually creating the database tables*

```
web-1  | 121 static files copied to '/app/static'.
```
*Collecting CSS, JavaScript, and image files*

```
web-1  | Watching for file changes with StatReloader
web-1  | Performing system checks...
web-1  | 
web-1  | System check identified no issues (0 silenced).
web-1  | September 11, 2025 - 10:30:45
web-1  | Django version 5.2.5, using settings 'umugandatech.settings'
web-1  | Starting development server at http://0.0.0.0:8000/
web-1  | Quit the server with CONTROL-C.
```
*Django development server is now running and ready!*

### Step 6: Test Your Application

**Open your web browser and visit:**

1. **Main Application**: http://localhost:8000
   - You should see your Django application
   - If you see a Django welcome page or your custom homepage, it's working!

2. **Admin Interface**: http://localhost:8000/admin
   - You'll see a login page
   - You need to create a superuser first (next step)

### Step 7: Create Your First Admin User

```bash
docker-compose exec web python manage.py createsuperuser
```

**Interactive Process:**
```
Username (leave blank to use 'root'): admin
Email address: admin@umugandatech.com
Password: [type your password - it won't show on screen]
Password (again): [type same password]
Superuser created successfully.
```

**Now you can:**
- Visit http://localhost:8000/admin
- Login with your admin credentials
- Manage users, projects, community posts, etc.

---

## 🔍 UNDERSTANDING WHAT HAPPENS BEHIND THE SCENES {#behind-scenes}

### When You Run `docker-compose up -d`

#### Phase 1: Network Creation
```
Docker creates: capstone-umuganda-tech-backend_default
```
This is like creating a **private telephone network** where your containers can call each other by name:
- Web container can reach database as `db:5432`
- Database can receive connections from web container

#### Phase 2: Volume Creation
```
Docker creates:
├── capstone-umuganda-tech-backend_postgres_data
├── capstone-umuganda-tech-backend_media_volume
└── capstone-umuganda-tech-backend_static_volume
```
These are like **permanent storage lockers**:
- **postgres_data**: Stores all your database files
- **media_volume**: Stores user uploads (profile pictures, documents)
- **static_volume**: Stores CSS, JavaScript, admin interface files

#### Phase 3: Database Container Startup
```
1. Docker pulls postgres:15 image
2. Creates container with environment variables:
   - POSTGRES_DB=umuganda_db
   - POSTGRES_USER=umuganda_user
   - POSTGRES_PASSWORD=StrongPassword123
3. PostgreSQL starts and initializes database
4. Health check begins (every 30 seconds)
5. Container marked as "healthy" when database responds
```

#### Phase 4: Web Container Build and Startup
```
1. Docker builds image from Dockerfile:
   ├── Installs Python 3.11
   ├── Installs system dependencies
   ├── Installs Python packages
   └── Copies your project files
2. Creates container with environment variables
3. Waits for database to be healthy
4. Runs entrypoint.sh:
   ├── Waits for database connection
   ├── Creates/applies migrations
   ├── Collects static files
   └── Starts Django server
```

### File System Mapping (Volumes Explained)

```
Your Computer                    Container
├── C:\Users\mkthi\...\backend  ←→  /app
├── Docker Volume postgres_data ←→  /var/lib/postgresql/data
├── Docker Volume media_volume  ←→  /app/media
└── Docker Volume static_volume ←→  /app/static
```

**What this means:**
- Changes to your code files are **immediately reflected** in the container
- Database data is **permanently stored** even if you delete containers
- User uploads are **permanently stored**
- Static files are **permanently stored**

### Network Communication

```
Your Browser → localhost:8000 → Docker → web container:8000 → Django
                                     ↓
Database Tool → localhost:5432 → Docker → db container:5432 → PostgreSQL
                                     ↓
web container → db:5432 → Docker Network → db container:5432 → PostgreSQL
```

---

## 💼 DEVELOPMENT WORKFLOW - EVERY SCENARIO COVERED {#development-workflow}

### Scenario 1: Starting Your Development Day

**Morning Routine:**
```bash
# 1. Open terminal in project directory
cd C:\Users\mkthi\OneDrive\Desktop\ProjectsSt\Umuganda_root\capstone-umuganda-tech-backend

# 2. Check if Docker is running
docker --version
# Should show: Docker version 20.x.x or similar

# 3. Start your application
docker-compose up -d

# 4. Verify everything is running
docker-compose ps

# 5. Check logs for any issues
docker-compose logs -f web
# Press Ctrl+C to stop following logs

# 6. Open your application
# Browser: http://localhost:8000
```

### Scenario 2: Making Code Changes

#### A. **View/Template Changes** (Immediate Effect)
```python
# Edit: apps/community/views.py
def post_list(request):
    posts = Post.objects.all()
    return render(request, 'community/post_list.html', {'posts': posts})
```

**What happens:**
1. You save the file
2. Django's auto-reloader detects the change
3. Django restarts automatically
4. Your changes are live immediately

**Check logs to confirm:**
```bash
docker-compose logs -f web
# You'll see: "Watching for file changes with StatReloader"
# Then: "/app/apps/community/views.py changed, reloading."
```

#### B. **Model Changes** (Requires Migration)
```python
# Edit: apps/users/models.py
class User(AbstractUser):
    phone_number = models.CharField(max_length=15, blank=True)  # New field
    bio = models.TextField(blank=True)  # New field
```

**Required steps:**
```bash
# 1. Create migration files
docker-compose exec web python manage.py makemigrations

# Expected output:
# Migrations for 'users':
#   apps/users/migrations/0002_user_bio_user_phone_number.py
#     - Add field bio to user
#     - Add field phone_number to user

# 2. Apply migrations to database
docker-compose exec web python manage.py migrate

# Expected output:
# Operations to perform:
#   Apply all migrations: admin, auth, authtoken, community, contenttypes, notifications, projects, sessions, users
# Running migrations:
#   Applying users.0002_user_bio_user_phone_number... OK
```

#### C. **Settings Changes** (Automatic Reload)
```python
# Edit: umugandatech/settings.py
ALLOWED_HOSTS = ['localhost', '127.0.0.1', 'yourdomain.com']  # Modified
```

**What happens:**
1. Save the file
2. Django detects settings change
3. Django restarts with new settings
4. Changes are active immediately

### Scenario 3: Adding New Python Packages

**Example: Adding a new package**
```txt
# Edit: requirements.txt
Django==5.2.5
psycopg2-binary==2.9.7
djangorestframework==3.14.0
pillow==10.0.0  # New package for image handling
```

**Required steps:**
```bash
# 1. Rebuild the web container with new packages
docker-compose build web

# Expected output shows package installation:
# => [4/9] RUN pip install --no-cache-dir -r requirements.txt  12.3s

# 2. Restart the web service
docker-compose up -d web

# 3. Verify the package is installed
docker-compose exec web pip list | grep pillow
# Should show: Pillow    10.0.0
```

### Scenario 4: Database Operations

#### A. **Viewing Database Data**
```bash
# Option 1: Django shell
docker-compose exec web python manage.py shell

# In the shell:
>>> from apps.users.models import User
>>> User.objects.all()
>>> User.objects.filter(is_superuser=True)
>>> exit()

# Option 2: Database shell
docker-compose exec web python manage.py dbshell

# In PostgreSQL shell:
\dt                          -- List all tables
SELECT * FROM users_user;    -- View user data
\q                          -- Quit
```

#### B. **Creating Test Data**
```bash
# Using Django shell
docker-compose exec web python manage.py shell

# Create test users:
>>> from apps.users.models import User
>>> user = User.objects.create_user(
...     username='testuser',
...     email='test@example.com',
...     password='testpass123'
... )
>>> user.save()
>>> exit()
```

#### C. **Database Backup and Restore**
```bash
# Create backup
docker-compose exec db pg_dump -U umuganda_user umuganda_db > backup_$(date +%Y%m%d_%H%M%S).sql

# Restore from backup
docker-compose exec -T db psql -U umuganda_user -d umuganda_db < backup_20240911_143022.sql
```

### Scenario 5: Working with Static Files

#### A. **Adding CSS/JavaScript**
```bash
# 1. Add files to your app's static directory
# Example: apps/community/static/community/css/style.css

# 2. Collect static files
docker-compose exec web python manage.py collectstatic

# 3. Files are now available at http://localhost:8000/static/
```

#### B. **Handling Media Files (User Uploads)**
```python
# In your model:
class Post(models.Model):
    image = models.ImageField(upload_to='posts/', blank=True)
```

**Files uploaded by users are automatically stored in the media_volume and accessible at:**
- Container path: `/app/media/posts/`
- URL: `http://localhost:8000/media/posts/filename.jpg`

### Scenario 6: Running Tests

```bash
# Run all tests
docker-compose exec web python manage.py test

# Run tests for specific app
docker-compose exec web python manage.py test apps.users

# Run tests with verbose output
docker-compose exec web python manage.py test --verbosity=2

# Run specific test class
docker-compose exec web python manage.py test apps.users.tests.UserModelTest

# Run with coverage (if coverage is installed)
docker-compose exec web coverage run manage.py test
docker-compose exec web coverage report
docker-compose exec web coverage html  # Creates HTML report
```

---

## 🗄️ DATABASE OPERATIONS - COMPLETE GUIDE {#database-guide}

### Understanding Your Database Structure

Your Umuganda Tech project has these main apps and their database tables:

```
📊 DATABASE: umuganda_db
├── 👥 users app
│   ├── users_user (main user table)
│   ├── users_badge (achievement badges)
│   ├── users_skill (user skills)
│   ├── users_userbadge (user-badge relationships)
│   └── users_userskill (user-skill relationships)
├── 🏗️ projects app
│   ├── projects_project (community projects)
│   ├── projects_projectcategory (project categories)
│   ├── projects_attendance (project attendance)
│   ├── projects_certificate (completion certificates)
│   └── projects_projectimpact (project impact tracking)
├── 💬 community app
│   ├── community_post (community posts)
│   ├── community_comment (post comments)
│   └── community_postupvote (post likes/upvotes)
└── 🔔 notifications app
    ├── notifications_notification (user notifications)
    └── notifications_notificationlog (notification history)
```

### Migration Operations (Detailed)

#### Understanding Migrations
Migrations are like **renovation instructions** for your database:
- **makemigrations**: Creates the renovation plan
- **migrate**: Actually does the renovation

#### Creating Migrations
```bash
# Create migrations for all apps
docker-compose exec web python manage.py makemigrations

# Create migrations for specific app
docker-compose exec web python manage.py makemigrations users

# Create empty migration (for custom operations)
docker-compose exec web python manage.py makemigrations --empty users

# Create migration with custom name
docker-compose exec web python manage.py makemigrations users --name add_phone_number
```

#### Applying Migrations
```bash
# Apply all pending migrations
docker-compose exec web python manage.py migrate

# Apply migrations for specific app
docker-compose exec web python manage.py migrate users

# Apply specific migration
docker-compose exec web python manage.py migrate users 0001

# Fake apply migration (mark as applied without running)
docker-compose exec web python manage.py migrate users 0001 --fake
```

#### Migration Status and History
```bash
# Show migration status
docker-compose exec web python manage.py showmigrations

# Show migration status for specific app
docker-compose exec web python manage.py showmigrations users

# Show migration plan (what will be applied)
docker-compose exec web python manage.py showmigrations --plan
```

### User Management Operations

#### Creating Users
```bash
# Create superuser (interactive)
docker-compose exec web python manage.py createsuperuser

# Create superuser (non-interactive)
docker-compose exec web python manage.py shell -c "
from apps.users.models import User
User.objects.create_superuser('admin', 'admin@example.com', 'password123')
"

# Create regular user
docker-compose exec web python manage.py shell -c "
from apps.users.models import User
User.objects.create_user('john', 'john@example.com', 'password123')
"
```

#### Managing Users
```bash
# Django shell for user operations
docker-compose exec web python manage.py shell

# In the shell:
>>> from apps.users.models import User

# List all users
>>> User.objects.all()

# Find specific user
>>> user = User.objects.get(username='john')
>>> print(f"User: {user.username}, Email: {user.email}")

# Update user
>>> user.first_name = "John"
>>> user.last_name = "Doe"
>>> user.save()

# Change password
>>> user.set_password('newpassword123')
>>> user.save()

# Make user superuser
>>> user.is_superuser = True
>>> user.is_staff = True
>>> user.save()

# Delete user
>>> user.delete()
```

### Database Inspection and Debugging

#### Using Django Shell
```bash
docker-compose exec web python manage.py shell

# Useful queries:
>>> from apps.users.models import User
>>> from apps.projects.models import Project
>>> from apps.community.models import Post

# Count records
>>> User.objects.count()
>>> Project.objects.count()
>>> Post.objects.count()

# Recent records
>>> User.objects.order_by('-date_joined')[:5]
>>> Post.objects.order_by('-created_at')[:10]

# Filter records
>>> active_projects = Project.objects.filter(is_active=True)
>>> recent_posts = Post.objects.filter(created_at__gte='2024-01-01')
```

#### Using Database Shell
```bash
# Access PostgreSQL directly
docker-compose exec web python manage.py dbshell

# Or access database container directly
docker-compose exec db psql -U umuganda_user -d umuganda_db

# Useful PostgreSQL commands:
\dt                                    -- List all tables
\d users_user                         -- Describe users table
SELECT COUNT(*) FROM users_user;       -- Count users
SELECT * FROM users_user LIMIT 5;     -- Show first 5 users
\q                                     -- Quit
```

### Data Import/Export Operations

#### Exporting Data
```bash
# Export all data (JSON format)
docker-compose exec web python manage.py dumpdata > full_backup.json

# Export specific app
docker-compose exec web python manage.py dumpdata users > users_backup.json

# Export specific model
docker-compose exec web python manage.py dumpdata users.User > users_only.json

# Export with indentation (readable format)
docker-compose exec web python manage.py dumpdata --indent 2 users > users_formatted.json

# Export excluding certain data
docker-compose exec web python manage.py dumpdata --exclude auth.permission --exclude contenttypes > clean_backup.json
```

#### Importing Data
```bash
# Import data
docker-compose exec web python manage.py loaddata full_backup.json

# Import specific fixture
docker-compose exec web python manage.py loaddata users_backup.json
```

### Database Maintenance

#### Database Reset (⚠️ Destructive Operations)
```bash
# Reset specific app migrations
docker-compose exec web python manage.py migrate users zero

# Reset all migrations (⚠️ WARNING: Deletes all data!)
docker-compose down -v  # Stops containers and deletes volumes
docker-compose up -d    # Starts fresh with empty database

# Alternative: Reset database without losing other data
docker-compose exec db psql -U umuganda_user -d umuganda_db -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"
docker-compose exec web python manage.py migrate
```

#### Database Optimization
```bash
# Analyze database performance
docker-compose exec db psql -U umuganda_user -d umuganda_db -c "ANALYZE;"

# Check database size
docker-compose exec db psql -U umuganda_user -d umuganda_db -c "
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
"
```

---

## 🔧 TROUBLESHOOTING - EVERY PROBLEM SOLVED {#troubleshooting}

### Problem Category 1: Container Startup Issues

#### Issue: "Service web is not running"
**Symptoms:**
```bash
$ docker-compose exec web python manage.py shell
service "web" is not running
```

**Diagnosis Steps:**
```bash
# 1. Check container status
docker-compose ps

# Possible outputs and meanings:
# STATUS: Up        → Container is running (good)
# STATUS: Exit 1    → Container crashed
# STATUS: Exit 0    → Container stopped normally
# No web container  → Container never started
```

**Solutions:**
```bash
# Solution 1: Start the services
docker-compose up -d

# Solution 2: Check logs for errors
docker-compose logs web
# Look for error messages like:
# - "ModuleNotFoundError"
# - "django.core.exceptions"
# - "psycopg2.OperationalError"

# Solution 3: Rebuild if there are dependency issues
docker-compose build web
docker-compose up -d web

# Solution 4: Complete restart
docker-compose down
docker-compose up -d
```

#### Issue: "Port 8000 is already in use"
**Symptoms:**
```
ERROR: for web  Cannot start service web: Ports are not available: listen tcp 0.0.0.0:8000: bind: address already in use
```

**Diagnosis:**
```bash
# Windows: Find what's using port 8000
netstat -ano | findstr :8000

# Output example:
# TCP    0.0.0.0:8000    0.0.0.0:0    LISTENING    1234
# The number 1234 is the Process ID (PID)
```

**Solutions:**
```bash
# Solution 1: Kill the process using the port
taskkill /PID 1234 /F

# Solution 2: Use a different port
# Edit docker-compose.yml:
ports:
  - "8001:8000"  # Use port 8001 instead
# Then access: http://localhost:8001

# Solution 3: Stop other Docker containers
docker stop $(docker ps -q)  # Stops all running containers
```

#### Issue: Database Connection Errors
**Symptoms:**
```
django.db.utils.OperationalError: could not connect to server: Connection refused
Is the server running on host "db" and accepting TCP/IP connections on port 5432?
```

**Diagnosis:**
```bash
# 1. Check if database container is running
docker-compose ps

# 2. Check database health
docker-compose exec db pg_isready -U umuganda_user -d umuganda_db

# 3. Check database logs
docker-compose logs db
```

**Solutions:**
```bash
# Solution 1: Wait for database to be ready
# Database takes 30-60 seconds to fully start
docker-compose logs -f db
# Wait for: "database system is ready to accept connections"

# Solution 2: Restart database service
docker-compose restart db

# Solution 3: Check database credentials
# Verify in docker-compose.yml:
# - POSTGRES_DB matches DB_NAME
# - POSTGRES_USER matches DB_USER  
# - POSTGRES_PASSWORD matches DB_PASSWORD

# Solution 4: Reset database volume
docker-compose down -v  # ⚠️ WARNING: Deletes all data!
docker-compose up -d
```

### Problem Category 2: Code and Migration Issues

#### Issue: Migration Errors
**Symptoms:**
```
django.db.migrations.exceptions.InconsistentMigrationHistory: Migration admin.0001_initial is applied before its dependency users.0001_initial on database 'default'.
```

**Solutions:**
```bash
# Solution 1: Reset migrations (⚠️ Development only!)
docker-compose exec web python manage.py migrate --fake-initial

# Solution 2: Reset specific app migrations
docker-compose exec web python manage.py migrate users zero
docker-compose exec web python manage.py migrate users

# Solution 3: Complete database reset
docker-compose down -v
docker-compose up -d
# This creates a fresh database with all migrations applied correctly
```

#### Issue: "No module named 'some_package'"
**Symptoms:**
```
ModuleNotFoundError: No module named 'pillow'
```

**Solutions:**
```bash
# Solution 1: Check if package is in requirements.txt
cat requirements.txt | grep pillow

# Solution 2: Add missing package to requirements.txt
echo "pillow==10.0.0" >> requirements.txt

# Solution 3: Rebuild container with new packages
docker-compose build web
docker-compose up -d web

# Solution 4: Install package temporarily (for testing)
docker-compose exec web pip install pillow
# Note: This is temporary and will be lost when container restarts
```

#### Issue: Static Files Not Loading
**Symptoms:**
- CSS/JavaScript not working
- Admin interface looks broken
- 404 errors for static files

**Solutions:**
```bash
# Solution 1: Collect static files
docker-compose exec web python manage.py collectstatic --noinput

# Solution 2: Check STATIC_ROOT setting
docker-compose exec web python manage.py shell -c "
from django.conf import settings
print('STATIC_ROOT:', settings.STATIC_ROOT)
print('STATIC_URL:', settings.STATIC_URL)
"

# Solution 3: Verify static volume mapping
docker-compose exec web ls -la /app/static/
# Should show collected static files

# Solution 4: Check URL configuration
# Ensure in umugandatech/urls.py:
# from django.conf import settings
# from django.conf.urls.static import static
# urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)
```

### Problem Category 3: Performance and Resource Issues

#### Issue: Containers Using Too Much Memory/CPU
**Diagnosis:**
```bash
# Check resource usage
docker stats

# Output shows:
# CONTAINER ID   NAME                                    CPU %     MEM USAGE / LIMIT
# abc123         capstone-umuganda-tech-backend-web-1    2.5%      150MiB / 8GiB
# def456         capstone-umuganda-tech-backend-db-1     1.2%      80MiB / 8GiB
```

**Solutions:**
```bash
# Solution 1: Limit container resources
# Add to docker-compose.yml:
services:
  web:
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
  db:
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.3'

# Solution 2: Clean up Docker system
docker system prune -a  # Removes unused images, containers, networks
docker volume prune     # Removes unused volumes
```

#### Issue: Slow Container Startup
**Diagnosis:**
```bash
# Time the startup process
time docker-compose up -d

# Check what's taking time in logs
docker-compose logs web | grep -E "(Installing|Collecting|Building)"
```

**Solutions:**
```bash
# Solution 1: Use Docker layer caching
# Optimize Dockerfile by putting frequently changing files last:
COPY requirements.txt /app/
RUN pip install -r requirements.txt  # This layer gets cached
COPY . /app/  # Only this layer rebuilds when code changes

# Solution 2: Use .dockerignore to exclude unnecessary files
# Create .dockerignore:
__pycache__
*.pyc
.git
.gitignore
README.md
.env
node_modules

# Solution 3: Pre-build images
docker-compose build  # Build once, then just use docker-compose up -d
```

### Problem Category 4: File Permission Issues

#### Issue: Permission Denied Errors
**Symptoms:**
```
PermissionError: [Errno 13] Permission denied: '/app/media/uploads/file.jpg'
```

**Solutions:**
```bash
# Solution 1: Fix file ownership (Linux/Mac)
sudo chown -R $USER:$USER .

# Solution 2: Fix directory permissions
docker-compose exec web chmod -R 755 /app/media
docker-compose exec web chmod -R 755 /app/static

# Solution 3: Create directories with correct permissions
docker-compose exec web mkdir -p /app/media/uploads
docker-compose exec web chmod 755 /app/media/uploads
```

### Problem Category 5: Network and Connectivity Issues

#### Issue: Can't Access Application from Browser
**Symptoms:**
- Browser shows "This site can't be reached"
- Connection timeout errors

**Diagnosis:**
```bash
# 1. Check if containers are running
docker-compose ps

# 2. Check port mapping
docker-compose ps
# Should show: 0.0.0.0:8000->8000/tcp

# 3. Test connection from command line
curl http://localhost:8000
# Should return HTML content
```

**Solutions:**
```bash
# Solution 1: Check firewall settings
# Windows: Allow Docker Desktop through Windows Firewall

# Solution 2: Try different URLs
http://localhost:8000
http://127.0.0.1:8000
http://0.0.0.0:8000

# Solution 3: Check Docker Desktop settings
# Ensure "Expose daemon on tcp://localhost:2375" is enabled if needed

# Solution 4: Restart Docker Desktop
# Sometimes Docker Desktop needs a restart to fix networking issues
```

### Emergency Recovery Procedures

#### Complete System Reset
```bash
# ⚠️ WARNING: This deletes ALL Docker data!
# 1. Stop all containers
docker-compose down -v

# 2. Remove all Docker resources
docker system prune -a --volumes

# 3. Restart Docker Desktop

# 4. Start fresh
docker-compose up -d

# 5. Recreate superuser
docker-compose exec web python manage.py createsuperuser
```

#### Backup Before Troubleshooting
```bash
# Always backup your database before major changes
docker-compose exec db pg_dump -U umuganda_user umuganda_db > emergency_backup_$(date +%Y%m%d_%H%M%S).sql

# Backup your code (if not in git)
cp -r . ../umuganda_backup_$(date +%Y%m%d_%H%M%S)
```

---

## 🚀 ADVANCED DOCKER OPERATIONS {#advanced-operations}

### Multi-Environment Setup

#### Development Environment (Current Setup)
```yaml
# docker-compose.yml (current)
services:
  web:
    build: .
    environment:
      - DEBUG=True
      - SECRET_KEY=django-insecure-key
    command: python manage.py runserver 0.0.0.0:8000
```

#### Production Environment
```yaml
# docker-compose.prod.yml
services:
  web:
    build: 
      context: .
      dockerfile: Dockerfile.prod
    environment:
      - DEBUG=False
      - SECRET_KEY=${SECRET_KEY}
    command: gunicorn umugandatech.wsgi:application --bind 0.0.0.0:8000
    restart: unless-stopped
  
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - static_volume:/app/static
    depends_on:
      - web
```

#### Testing Environment
```yaml
# docker-compose.test.yml
services:
  web:
    build: .
    environment:
      - DEBUG=True
      - SECRET_KEY=test-key
      - DB_NAME=test_umuganda_db
    command: python manage.py test --verbosity=2
```

**Usage:**
```bash
# Development (default)
docker-compose up -d

# Production
docker-compose -f docker-compose.prod.yml up -d

# Testing
docker-compose -f docker-compose.test.yml up --abort-on-container-exit
```

### Docker Compose Override Files

Create `docker-compose.override.yml` for local customizations:
```yaml
# docker-compose.override.yml (automatically loaded)
services:
  web:
    ports:
      - "8001:8000"  # Use different port locally
    environment:
      - DEBUG=True
      - CUSTOM_SETTING=local_value
    volumes:
      - ./local_settings.py:/app/local_settings.py
```

### Advanced Volume Management

#### Named Volumes with Backup
```yaml
volumes:
  postgres_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /path/to/backup/location
```

#### Volume Backup and Restore
```bash
# Backup volume
docker run --rm -v capstone-umuganda-tech-backend_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_backup.tar.gz -C /data .

# Restore volume
docker run --rm -v capstone-umuganda-tech-backend_postgres_data:/data -v $(pwd):/backup alpine tar xzf /backup/postgres_backup.tar.gz -C /data
```

### Container Health Monitoring

#### Advanced Health Checks
```yaml
services:
  web:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  db:
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U umuganda_user -d umuganda_db"]
      interval: 10s
      timeout: 5s
      retries: 5
```

#### Monitoring Commands
```bash
# Check health status
docker-compose ps

# Watch health status
watch docker-compose ps

# Get detailed health info
docker inspect capstone-umuganda-tech-backend-web-1 | grep -A 10 Health
```

### Performance Optimization

#### Multi-Stage Dockerfile
```dockerfile
# Dockerfile.optimized
# Build stage
FROM python:3.11-slim as builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# Production stage
FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
ENV PATH=/root/.local/bin:$PATH
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
```

#### Resource Limits
```yaml
services:
  web:
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
```

### Logging and Monitoring

#### Centralized Logging
```yaml
services:
  web:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
  
  db:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

#### Log Analysis
```bash
# View logs with timestamps
docker-compose logs -t web

# Follow logs from specific time
docker-compose logs --since="2024-01-01T00:00:00" web

# Export logs
docker-compose logs web > web_logs_$(date +%Y%m%d).log

# Analyze log patterns
docker-compose logs web | grep ERROR
docker-compose logs web | grep -c "GET /"
```

---

## 🏭 PRODUCTION DEPLOYMENT GUIDE {#production-guide}

### Production-Ready Configuration

#### Environment Variables
Create `.env.production`:
```env
# Security
DEBUG=False
SECRET_KEY=your-super-secure-production-key-here-minimum-50-characters
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com

# Database
DB_ENGINE=django.db.backends.postgresql
DB_NAME=umuganda_prod_db
DB_USER=umuganda_prod_user
DB_PASSWORD=your-very-secure-database-password
DB_HOST=db
DB_PORT=5432

# CORS (restrict to your frontend domain)
CORS_ALLOW_ALL_ORIGINS=False
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# Email (for notifications)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# Storage (for production file handling)
USE_S3=True
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_STORAGE_BUCKET_NAME=umuganda-media-files
```

#### Production Docker Compose
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  db:
    image: postgres:15
    volumes:
      - postgres_prod_data:/var/lib/postgresql/data/
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    restart: unless-stopped
    networks:
      - backend

  web:
    build:
      context: .
      dockerfile: Dockerfile.prod
    command: gunicorn umugandatech.wsgi:application --bind 0.0.0.0:8000 --workers 3
    volumes:
      - static_volume:/app/static
      - media_volume:/app/media
    environment:
      - DEBUG=${DEBUG}
      - SECRET_KEY=${SECRET_KEY}
      - DB_ENGINE=${DB_ENGINE}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_HOST=db
      - DB_PORT=5432
      - ALLOWED_HOSTS=${ALLOWED_HOSTS}
    depends_on:
      - db
    restart: unless-stopped
    networks:
      - backend
      - frontend

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
      - static_volume:/app/static
      - media_volume:/app/media
    depends_on:
      - web
    restart: unless-stopped
    networks:
      - frontend

  redis:
    image: redis:alpine
    restart: unless-stopped
    networks:
      - backend

  celery:
    build:
      context: .
      dockerfile: Dockerfile.prod
    command: celery -A umugandatech worker -l info
    volumes:
      - media_volume:/app/media
    environment:
      - DEBUG=${DEBUG}
      - SECRET_KEY=${SECRET_KEY}
      - DB_ENGINE=${DB_ENGINE}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_HOST=db
      - DB_PORT=5432
    depends_on:
      - db
      - redis
    restart: unless-stopped
    networks:
      - backend

volumes:
  postgres_prod_data:
  static_volume:
  media_volume:

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
```

#### Production Dockerfile
```dockerfile
# Dockerfile.prod
FROM python:3.11-slim

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Set work directory
WORKDIR /app

# Install system dependencies
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        postgresql-client \
        build-essential \
        libpq-dev \
        nginx \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
COPY requirements.prod.txt /app/
RUN pip install --no-cache-dir -r requirements.prod.txt

# Copy project
COPY . /app/

# Collect static files
RUN python manage.py collectstatic --noinput

# Create non-root user
RUN adduser --disabled-password --gecos '' appuser
RUN chown -R appuser:appuser /app
USER appuser

# Expose port
EXPOSE 8000

# Health check
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health/ || exit 1

# Start gunicorn
CMD ["gunicorn", "umugandatech.wsgi:application", "--bind", "0.0.0.0:8000", "--workers", "3"]
```

#### Production Requirements
```txt
# requirements.prod.txt
Django==5.2.5
psycopg2-binary==2.9.7
djangorestframework==3.14.0
django-cors-headers==4.3.1
djangorestframework-simplejwt==5.3.0
python-decouple==3.8
django-extensions==3.2.3
gunicorn==21.2.0
whitenoise==6.6.0
celery==5.3.4
redis==5.0.1
boto3==1.34.0
django-storages==1.14.2
sentry-sdk==1.38.0
```

### SSL/HTTPS Configuration

#### Nginx Configuration
```nginx
# nginx/nginx.conf
events {
    worker_connections 1024;
}

http {
    upstream web {
        server web:8000;
    }

    # Redirect HTTP to HTTPS
    server {
        listen 80;
        server_name yourdomain.com www.yourdomain.com;
        return 301 https://$server_name$request_uri;
    }

    # HTTPS server
    server {
        listen 443 ssl http2;
        server_name yourdomain.com www.yourdomain.com;

        # SSL configuration
        ssl_certificate /etc/nginx/ssl/cert.pem;
        ssl_certificate_key /etc/nginx/ssl/key.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;

        # Security headers
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";

        # Static files
        location /static/ {
            alias /app/static/;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }

        # Media files
        location /media/ {
            alias /app/media/;
            expires 1y;
            add_header Cache-Control "public";
        }

        # Django application
        location / {
            proxy_pass http://web;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

### Deployment Process

#### Initial Deployment
```bash
# 1. Clone repository on server
git clone https://github.com/yourusername/capstone-umuganda-tech-backend.git
cd capstone-umuganda-tech-backend

# 2. Create production environment file
cp .env.example .env.production
# Edit .env.production with production values

# 3. Build and start production services
docker-compose -f docker-compose.prod.yml up -d --build

# 4. Run initial setup
docker-compose -f docker-compose.prod.yml exec web python manage.py migrate
docker-compose -f docker-compose.prod.yml exec web python manage.py collectstatic --noinput
docker-compose -f docker-compose.prod.yml exec web python manage.py createsuperuser

# 5. Test deployment
curl -I https://yourdomain.com
```

#### Continuous Deployment
```bash
#!/bin/bash
# deploy.sh - Deployment script

set -e  # Exit on any error

echo "Starting deployment..."

# Pull latest code
git pull origin main

# Build new images
docker-compose -f docker-compose.prod.yml build

# Run database migrations
docker-compose -f docker-compose.prod.yml exec web python manage.py migrate

# Collect static files
docker-compose -f docker-compose.prod.yml exec web python manage.py collectstatic --noinput

# Restart services with zero downtime
docker-compose -f docker-compose.prod.yml up -d --no-deps web

# Health check
sleep 10
if curl -f https://yourdomain.com/health/; then
    echo "Deployment successful!"
else
    echo "Deployment failed - rolling back"
    docker-compose -f docker-compose.prod.yml rollback
    exit 1
fi
```

### Monitoring and Maintenance

#### Health Check Endpoint
```python
# Add to umugandatech/urls.py
from django.http import JsonResponse
from django.db import connection

def health_check(request):
    try:
        # Check database connection
        with connection.cursor() as cursor:
            cursor.execute("SELECT 1")
        
        return JsonResponse({
            'status': 'healthy',
            'database': 'connected',
            'timestamp': timezone.now().isoformat()
        })
    except Exception as e:
        return JsonResponse({
            'status': 'unhealthy',
            'error': str(e),
            'timestamp': timezone.now().isoformat()
        }, status=503)

urlpatterns = [
    # ... other patterns
    path('health/', health_check, name='health_check'),
]
```

#### Monitoring Commands
```bash
# Check service status
docker-compose -f docker-compose.prod.yml ps

# Monitor resource usage
docker stats

# Check logs
docker-compose -f docker-compose.prod.yml logs -f web

# Database backup
docker-compose -f docker-compose.prod.yml exec db pg_dump -U umuganda_prod_user umuganda_prod_db | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz

# Update SSL certificates (if using Let's Encrypt)
docker-compose -f docker-compose.prod.yml exec nginx nginx -s reload
```

---

This comprehensive documentation covers every aspect of working with Docker for your Umuganda Tech project. Save this as a reference document and refer to specific sections as needed. Each section builds upon the previous ones, so you can start with the basics and gradually work your way up to advanced operations.